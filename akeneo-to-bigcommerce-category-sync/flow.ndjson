{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"scheduler-entry","identifier":"akeneo-fetch-categories","name":"Akeneo - Fetch - Categories","description":"We need to get all categories from Akeneo system to ensure the parent children relation can be sent in the right order. To do so, we use an Incoming **\"Akeneo - Fetch - Categories\"** to get data from Akeneo Server.","object":{"parameters":{"job":[{"prototype":"run-incoming","parameters":{"incoming":"akeneo-fetch-categories"}}],"handlers":[],"priority":2,"expression":"*/15 * * * *"}},"owner":null,"disabled":true}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"incoming-configuration","identifier":"akeneo-fetch-categories","name":"Akeneo - Fetch - Categories","description":"Fetch all categories from Akeneo and create them into Alumio Task","object":{"parameters":{"entityType":"base-category","subscriber":{"prototype":"http-subscriber","parameters":{"client":"akeneo-http-client","request":{"uri":"/api/rest/v1/categories","payload":[],"plugins":[],"payloadType":"data","authentications":[]},"pagination":{"prototype":"next","parameters":{"pattern":"_links.next","pageLimit":10000}},"deserializer":{"prototype":"json","parameters":{"pattern":"_embedded.items","readMethod":"wholeFile","encodeInput":false}}}},"transformers":["akeneo-prepare-convert-category-labels-to-localizations","akeneo-convert-category-to-alumio-base","akeneo-filter-category"]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"http-client","identifier":"akeneo-http-client","name":"Akeneo - HTTP Client","description":"","object":{"prototype":"akeneo-http-client-v2","parameters":{"key":"","baseUri":"${AKENEO_BASE_URL}","clientId":"${AKENEO_CLIENT_ID}","password":"${AKENEO_PASSWORD}","username":"${AKENEO_USERNAME}","clientSecret":"${AKENEO_CLIENT_SECRET}","enableLogging":true,"loggerFormatter":"full"}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"entity","identifier":"base-category","name":"Base - Category","description":"","object":{"parameters":{"schema":[],"identifierPath":["code"]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"akeneo-prepare-convert-category-labels-to-localizations","name":"Akeneo - Prepare convert category - Labels - To localizations","description":"Preparing convert into Alumio Base Category by converting labels into array consist of localCode and localizations","object":{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"accessor-move","parameters":{"source":{"prototype":"key","parameters":{"keys":[],"root":"labels"}},"destination":{"prototype":"structure","parameters":{"key":"localeCode","keys":[],"root":"localizations","value":"translation"}},"stripEnclosures":true}},{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"labels"}]}}]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"akeneo-convert-category-to-alumio-base","name":"Akeneo - Convert - Category - To Alumio Base","description":"Convert Akeneo Category into Alumio Base Category","object":{"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"_links"},{"key":"updated"}]}}]}}]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"akeneo-filter-category","name":"Akeneo - Filter - Category","description":"Filter Alumio Base Category which previously created into task  to avoid duplication","object":{"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"type-setter","parameters":{"entityType":"base-category"}},{"meta":[],"prototype":"storage-filter-stored-entity","parameters":{"storage":"akeneo-filter-categories","addEntityToStorage":true}}]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"storage","identifier":"akeneo-filter-categories","name":"Akeneo - Filter - Categories","description":"","object":{"parameters":{"path":"akeneo-filter-categories-01JXW5YRVQVTVK2MT3P4RA44F0","logger":{"parameters":{"actions":[]}}}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"scheduler-entry","identifier":"bigcommerce-send-categories","name":"BigCommerce - Send - Categories","description":"The task that was created through Incoming **\"Akeneo - Fetch - Categories\"** will then processed further by the Route **\"Synchronize Categories - From Akeneo into BigCommerce\"** and will be send using the Outgoing **\"BigCommerce - Send - Category\"**.","object":{"parameters":{"job":[{"prototype":"run-outgoing","parameters":{"route":"synchronize-categories-from-akeneo-into-bigcommerce","numTasks":100}}],"handlers":[],"priority":2,"expression":"*/15 * * * *"}},"owner":null,"disabled":true}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"route-configuration","identifier":"synchronize-categories-from-akeneo-into-bigcommerce","name":"Synchronize Categories - From Akeneo into BigCommerce","description":"","object":{"parameters":{"incoming":"akeneo-fetch-categories","outgoing":"bigcommerce-send-category","realtime":false,"transformers":[],"waitingStatus":false,"parallelExecution":[]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"outgoing-configuration","identifier":"bigcommerce-send-category","name":"BigCommerce - Send - Category","description":"","object":{"parameters":{"publisher":{"prototype":"no-action-publisher","parameters":[]},"transformers":["bigcommerce-prepare-convert-category-parent-id-from-alumio-base-category","bigcommerce-convert-category-from-alumio-base-category","bigcommerce-check-and-send-category"]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"bigcommerce-prepare-convert-category-parent-id-from-alumio-base-category","name":"BigCommerce - Prepare convert - Category - Parent id from Alumio Base Category","description":"","object":{"prototype":"data","parameters":{"filters":[],"transformers":[{"prototype":"conditional","parameters":{"filters":[{"prototype":"and-condition","parameters":{"filters":[{"prototype":"key-condition","parameters":{"filter":{"prototype":"key-exists-condition","parameters":{"path":"parent"}}}}]}},{"prototype":"value-condition-v2","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"parent"}},"conditions":[{"prototype":"not-empty","parameters":[]}]}}],"elseCases":[],"transformers":[{"meta":[],"prototype":"conditional","parameters":{"filters":[{"prototype":"value-condition-v2","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"parent"}},"conditions":[{"prototype":"not-equals","parameters":{"value":null}},{"prototype":"not-equals","parameters":{"value":[]}}]}}],"elseCases":[],"transformers":[{"meta":[],"prototype":"storage-get-entity-from-storage","parameters":{"storage":"bigcommerce-category-code-to-id","storageKey":"&{parent}","destination":"parent_id"}},{"meta":[],"prototype":"conditional","parameters":{"filters":[{"prototype":"key-condition","parameters":{"filter":{"prototype":"key-not-exists-condition","parameters":{"path":"parent_id"}}}}],"elseCases":[],"transformers":[{"meta":[],"prototype":"exception","parameters":{"message":"Category id not found for parent"}}],"elseTransformers":[{"prototype":"value-remover","parameters":{"patterns":[{"key":"parent"}]}}]}}],"elseTransformers":[]}}],"elseTransformers":[]}}]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"storage","identifier":"bigcommerce-category-code-to-id","name":"BigCommerce - Category - Code to id","description":"Category Akeneo Code into BigCommerce Id","object":{"parameters":{"path":"bigcommerce-category-code-to-id-01JXYPW4FAZ2RY5VM62XWBNXH6","logger":{"parameters":{"actions":[]}}}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"bigcommerce-convert-category-from-alumio-base-category","name":"BigCommerce - Convert - Category - from Alumio Base Category","description":"","object":{"meta":[],"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"pattern-move","parameters":{"pattern":"code","conditions":[],"replacement":"name"}},{"meta":[],"prototype":"value-setter","parameters":{"configurations":[{"key":"description","value":"&{(localizations[?localeCode=='en_US'].translation | [0])}","mappers":[]},{"key":"is_visible","value":true,"mappers":[]},{"key":"default_product_sort","value":"use_store_settings","mappers":[]}]}},{"meta":[],"prototype":"conditional","parameters":{"filters":[{"prototype":"key-condition","parameters":{"filter":{"prototype":"key-not-exists-condition","parameters":{"path":"parent_id"}}}}],"elseCases":[],"transformers":[{"meta":[],"prototype":"value-setter","parameters":{"configurations":[{"key":"tree_id","value":1,"mappers":[]}]}}],"elseTransformers":[]}},{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"localizations"},{"key":"parent"},{"key":"channel_requirements"}]}}]}}]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"bigcommerce-check-and-send-category","name":"BigCommerce - Check and send - Category","description":"This transformer will check current BigCommerce id from previous iteration of this transformer to determine either we need to create or update the category in the BigCommerce System.","object":{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"storage-get-entity-from-storage","parameters":{"storage":"bigcommerce-category-code-to-id","storageKey":"&{name}","destination":"category_id"}},{"meta":[],"prototype":"conditional","parameters":{"filters":[{"prototype":"key-condition","parameters":{"filter":{"prototype":"key-not-exists-condition","parameters":{"path":"category_id"}}}}],"elseCases":[],"transformers":[{"prototype":"value-setter","parameters":{"configurations":[{"key":"payload","value":["&{@}"],"mappers":[]}]}},{"meta":[],"prototype":"http-transformer","parameters":{"client":"bigcommerce-client","request":{"uri":"/v3/catalog/trees/categories","method":"POST","payload":"&{payload}","plugins":[],"payloadType":"data","authentications":[]}}},{"meta":[],"prototype":"storage-save-entity-in-storage","parameters":{"source":"data.0.category_id","storage":"bigcommerce-category-code-to-id","storageKey":"&{data[0].name}"}}],"elseTransformers":[{"prototype":"value-setter","parameters":{"configurations":[{"key":"payload","value":["&{@}"],"mappers":[]}]}},{"prototype":"http-transformer","parameters":{"client":"bigcommerce-client","request":{"uri":"/v3/catalog/trees/categories","method":"PUT","payload":"&{payload}","plugins":[],"payloadType":"data","authentications":[]}}}]}}]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"http-client","identifier":"bigcommerce-client","name":"BigCommerce - HTTP Client","description":"","object":{"prototype":"bigcommerce-http-client-v3","parameters":{"key":"","scopes":"store_v2_products","advanced":{"client":"default"},"clientId":"${BIGCOMMERCE_CLIENT_ID}","storeHash":"${BIGCOMMERCE_STORE_HASH}","clientSecret":"${BIGCOMMERCE_CLIENT_SECRET}","enableLogging":true,"loggerFormatter":"full","authenticationType":"oauth2"}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"http-client","identifier":"default","name":"Default client","object":{"parameters":{"plugins":[{"prototype":"logger","parameters":{"formatter":"long"}}]}}}